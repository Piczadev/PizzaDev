#!/usr/bin/env python3
# service_scanner.py

import nmap
import sys

scanner = nmap.PortScanner()

def escanear(ip):
    print(f"\n[+] Escaneando servicios y versiones en {ip}...\n")
    scanner.scan(ip, arguments='-sV')

    for host in scanner.all_hosts():
        print(f"Host: {host} ({scanner[host].hostname()})")
        print(f"Estado: {scanner[host].state()}")

        for proto in scanner[host].all_protocols():
            print(f"\nProtocolo: {proto.upper()}")
            ports = scanner[host][proto].keys()
            for port in sorted(ports):
                servicio = scanner[host][proto][port]['name']
                producto = scanner[host][proto][port].get('product', '')
                version = scanner[host][proto][port].get('version', '')
                extra = scanner[host][proto][port].get('extrainfo', '')
                print(f"  âž¤ {port}/tcp | {servicio} | {producto} {version} {extra}")

if __name__ == "__main__":
    if len(sys.argv) != 2:
        print("Uso: python service_scanner.py <IP>")
    else:
        escanear(sys.argv[1])
